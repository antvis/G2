---
title: G2 4.0 å‡çº§æŒ‡å—
order: 9
---

## æ¦‚è¿°

ä½œä¸ºå›¾å½¢è¯­æ³•ï¼ˆthe Grammar of Graphicsï¼‰çš„å‰ç«¯å®ç°ï¼ŒG2 å·²ç»ç»å†å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ã€‚æœ¬æ¬¡ G2 4.0 æ˜¯ä¸€ä¸ªæ–°çš„èµ·ç‚¹ï¼Œæˆ‘ä»¬å¯¹åº•å±‚æ¶æ„åšäº†å¤§é‡çš„é‡æ„å·¥ä½œï¼ŒG2 ä¼šæ›´åŠ å…³æ³¨äºï¼š**å›¾å½¢è¯­æ³•ï¼Œäº¤äº’è¯­æ³•**ä»¥åŠ**å¯è§†åŒ–ç»„ä»¶ä½“ç³»**çš„å»ºè®¾ã€‚æˆ‘ä»¬å¸Œæœ› G2 4.0 ä¼šæˆä¸ºä¸€ä¸ªä¸“ä¸šçš„ã€ç»™ç”¨æˆ·å¸¦æ¥æ›´å¤šå¯èƒ½æ€§çš„å¯è§†åŒ–åº•å±‚å¼•æ“ï¼Œåœ¨æ»¡è¶³ä¼ ç»Ÿå‹ç»Ÿè®¡å›¾è¡¨éœ€æ±‚çš„åŸºç¡€ä¸Šï¼Œèƒ½å¤Ÿæ›´å¥½åœ°èµ‹èƒ½äºï¼ˆä½†ä¸é™äºï¼‰ï¼š

- è®©å¼€å‘è€…åŸºäº G2 4.0 å¯ä»¥æ›´å¿«æ›´å¥½åœ°å°è£…ä¸Šå±‚å›¾è¡¨åº“
- è®©äº¤äº’å¼å¯è§†åŒ–æ›´ç®€å•
- æˆä¸ºå¯è§†åŒ–é¢†åŸŸçš„ä¸“ä¸šå·¥å…·

è™½ç„¶æˆ‘ä»¬å¯¹ G2 å†…éƒ¨è¿›è¡Œäº†å¤§è§„æ¨¡çš„é‡æ„å·¥ä½œï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†æµç¨‹ï¼ˆå¼•å…¥æ•°æ®æ›´æ–°æœºåˆ¶ï¼‰ï¼Œå›¾è¡¨ç»„ä»¶ï¼Œview æ¸²æŸ“æ›´æ–°é€»è¾‘ä»¥åŠäº‹ä»¶ã€äº¤äº’æœºåˆ¶æ”¹é€ ç­‰ï¼Œä½†æ˜¯ä¸ºäº†ä¿éšœç”¨æˆ·é¡¹ç›®èƒ½å¤Ÿæ›´å¹³æ»‘å¾—å‡çº§ï¼Œå¯¹äº API å±‚çš„ä»£ç ï¼Œæˆ‘ä»¬åŸºæœ¬æ²¡æœ‰åšå¤§çš„æ”¹åŠ¨ï¼Œå¯¹äºæ”¹åŠ¨ä¹‹å¤„ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡å‡çº§æŒ‡å—ã€API æ–‡æ¡£ç­‰æ–¹å¼æ¥å¸®åŠ©å¤§å®¶æ›´å¥½æ›´å¿«å¾—è¿›è¡Œå‡çº§ã€‚

## å˜æ›´è¯´æ˜

### æ•´ä½“å˜åŒ–

1. å…¨é¢æ‹¥æŠ± TypeScriptã€‚
1. å…¨æ–°çš„å¯è§†åŒ–ç»„ä»¶ï¼šé¢å‘äº¤äº’ï¼Œä½“éªŒä¼˜é›…ã€‚
1. å¼ºå¤§çš„ View æ¨¡å—ï¼šå¯å•ç‹¬ä½¿ç”¨ï¼Œå…·å¤‡å®Œå¤‡çš„å¯è§†åŒ–ç»„ä»¶ã€äº‹ä»¶ï¼Œæ”¯æŒ View åµŒå¥—ä»¥åŠè‡ªåŠ¨å¸ƒå±€ã€‚
1. å…¨æ–°çš„äº¤äº’è¯­æ³•ã€‚
1. ç»˜å›¾å¼•æ“å‡çº§è‡³ G 0.4 ç‰ˆæœ¬ï¼Œæ”¯æŒåŒå¼•æ“åˆ‡æ¢ã€‚
1. å¼•å…¥æ•°æ®æ›´æ–°æœºåˆ¶ã€‚
1. åŠ¨ç”»æœºåˆ¶æ”¹é€ ï¼Œæ›´ç»†ç²’åº¦ï¼Œä½“éªŒæ›´å¥½ã€‚
1. æ¨¡å—åŒ–ç®¡ç†ï¼Œæä¾›æ›´åŠ çµæ´»çš„æ‰©å±•æœºåˆ¶ã€‚

### API å˜æ›´

G2 4.0 åœ¨åŠŸèƒ½ä¸Šå…¨é¢å…¼å®¹ 3.x çš„åŠŸèƒ½ï¼Œåœ¨ API æ¥å£ä¸Šï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œåœ¨æœ€å¤§ç¨‹åº¦å…¼å®¹ 3.x è¯­æ³•çš„åŸºç¡€ä¸Šï¼Œæä¾›äº†å¯¹ç”¨æˆ·æ›´åŠ å‹å¥½ï¼Œæ›´æ˜“ç†è§£çš„å‡½æ•°å‘½åä»¥åŠæ›´åˆç†çš„é…ç½®é¡¹ç»“æ„ï¼Œå…·ä½“çš„å˜åŒ–è®°å½•å¦‚ä¸‹ï¼š

#### ä¸å…¼å®¹æ”¹åŠ¨

- ğŸ—‘ï¸ `chart.source()` æ¥å£åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `chart.data()` æ¥å£ï¼ŒåŒæ—¶åˆ—å®šä¹‰è¯·é€šè¿‡ `chart.scale()`Â  æ¥å£è¿›è¡Œå®šä¹‰ã€‚
- ğŸ—‘ï¸ `chart.coord()` æ¥å£åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `chart.coordinate()`ã€‚
- ğŸ—‘ï¸ `chart.guide()` æ¥å£åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `chart.annotation()`ï¼ŒåŒæ—¶ä¸å†æ”¯æŒ `chart.guide().html()`ã€‚
- ğŸ—‘ï¸ `chart.view()`Â  æ¥å£åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `chart.createView()`ã€‚
- ğŸ—‘ï¸ `chart.interact()`Â  æ¥å£åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `chart.interaction()`ã€‚
- ğŸ—‘ï¸ `chart.repaint()`Â  æ¥å£åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `chart.render(update: boolean)` æ¥å£ã€‚
- ğŸ—‘ï¸ è€ƒè™‘åˆ° G2 ä½¿ç”¨ç¯å¢ƒçš„ä¸åŒï¼ˆæµè§ˆå™¨ã€mobile ç­‰ï¼‰ï¼Œv3 ç‰ˆæœ¬ä¸­å…³äºå›¾ç‰‡ä¸‹è½½çš„æ¥å£ï¼š`chart.toDataURL` ä»¥åŠ `chart.downloadImage()` æ¥å£åºŸå¼ƒï¼Œå…·ä½“æ–¹æ¡ˆå¯å‚è€ƒ [FAQ](./faq)ã€‚
- ğŸ—‘ï¸Â `G2.Global` ç§»é™¤ï¼Œé»˜è®¤çš„ä¸»é¢˜é…ç½®å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ï¼š

```typescript
// æ–¹å¼ 1
import { getTheme } from '@antv/g2';
const defaultTheme = getTheme();

// æ–¹å¼ 2ï¼Œé€šè¿‡ chart ç¤ºä¾‹è·å–å½“å‰ä¸»é¢˜
const theme = chart.getTheme();
```

- ğŸ—‘ï¸ `geometry.active()`Â  åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `geometry.state()` æ¥å£ã€‚
- ğŸ—‘ï¸ `geometry.select()`Â  åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `geometry.state()` æ¥å£ã€‚
- ğŸ—‘ï¸ `geometry.opacity()` åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `geometry.color()`Â  ä¸­ä½¿ç”¨å¸¦é€æ˜åº¦çš„é¢œè‰²æˆ–è€… `geometry.style()`Â  æ¥å£ã€‚
- ä»¥ä¸‹è¯­æ³•ç³–ä¸å†æ”¯æŒï¼š
  - ğŸ—‘ï¸ `pointJitter()`Â  åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `point().adjust('jitter')`ã€‚
  - ğŸ—‘ï¸ `pointDodge()`Â  åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `point().adjust('dodge')`ã€‚
  - ğŸ—‘ï¸Â `intervalStack()` åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `interval().adjust('stack')`ã€‚
  - ğŸ—‘ï¸Â `intervalDodge()` åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `interval().adjust('dodge')`ã€‚
  - ğŸ—‘ï¸Â `intervalSymmetric()` åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `interval().adjust('symmetric')`ã€‚
  - ğŸ—‘ï¸Â `areaStack()` åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `area().adjust('stack')`ã€‚
  - ğŸ—‘ï¸Â `schemaDodge()` åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ Â `schema().adjust('stack')`ã€‚
- ğŸ—‘ï¸ `Venn`Â  ä»¥åŠ `Violin`Â  å‡ ä½•æ ‡è®°æš‚æ—¶ç§»é™¤ï¼Œåç»­è€ƒè™‘ä»¥æ›´å¥½çš„æ–¹å¼æ”¯æŒã€‚
- ğŸ—‘ï¸ ç§»é™¤ Interval å‡ ä½•æ ‡è®°ä»¥ä¸‹ä¸¤ä¸ª shape: 'top-line' åŠ Â 'liquid-fill-gauge'ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Shape æœºåˆ¶è‡ªå·±å®ç°ã€‚
- ğŸ—‘ï¸ ç§»é™¤ tail ç±»å‹çš„å›¾ä¾‹ã€‚
- å†…ç½®å¸¸é‡é‡å‘½åï¼Œä¸€è‡´ä½¿ç”¨å°å†™ + '-' å‘½åè§„åˆ™ï¼Œæ¯”å¦‚ `shape('hollowCircle')` å˜æ›´ä¸º `shape('hollow-circle')`ã€‚

#### é…ç½®é¡¹ä»¥åŠæ¥å£å˜æ›´

æˆ‘ä»¬åœ¨ 4.0 ä¸­å¯¹ä»¥ä¸‹æ¥å£ä»¥åŠä¸€äº›æ¥å£ä¸­çš„å±æ€§è¿›è¡Œäº†éƒ¨åˆ†å˜æ›´ï¼Œåœ¨å…¼å®¹ 3.x åŸæœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œè®©é…ç½®é¡¹æ›´å…·è¯­ä¹‰ï¼ŒåŒæ—¶ç»“æ„æ›´åŠ åˆç†ï¼Œå…·ä½“è¯·å‚è€ƒ API æ–‡æ¡£ã€‚

- `new Chart(cfg)`Â  æ¥å£å±æ€§æ›´æ–°ï¼š
  - 4.0 ä»£ç ä½¿ç”¨ç¤ºä¾‹ï¼š

```typescript
const chart = new Chart({
  container: 'container',
  autoFit: true,
  height: 500,
});
```

> æ–°è€æ¥å£å¯¹æ¯”ï¼š[https://github.com/simaQ/g2-v4-upgrade/pull/1/files#diff-6477dff11424caa76a176cf710e71023R16](https://github.com/simaQ/g2-v4-upgrade/pull/1/files#diff-6477dff11424caa76a176cf710e71023R16)

- `chart.data()`Â  æ¥å£ä¸å†æ”¯æŒ DataView æ ¼å¼æ•°æ®ï¼Œåªæ”¯æŒæ ‡å‡† JSON æ•°ç»„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ DataSet æ—¶ï¼Œè¦å–æœ€åçš„ JSON æ•°ç»„ç»“æœä¼ å…¥ G2ï¼š[https://github.com/simaQ/g2-v4-upgrade/pull/1/files#diff-660f42f89c29e15f5f86a3e8c1023302R23](https://github.com/simaQ/g2-v4-upgrade/pull/1/files#diff-660f42f89c29e15f5f86a3e8c1023302R23)

```typescript
chart.data(dv.rows);
```

- æ‰€æœ‰åŒç»˜å›¾ç›¸å…³çš„é…ç½®å…¨éƒ¨å®šä¹‰åœ¨ style å±æ€§ä¸­:

```ts
chart.axis('value', {
  label: {
    style: {
      textAlign: 'center',
    }, // è®¾ç½®åæ ‡è½´æ–‡æœ¬æ ·å¼
  },
  line: {
    style: {
      stroke: '#E9E9E9',
      lineDash: [3, 3],
    }, // è®¾ç½®åæ ‡è½´çº¿æ ·å¼
  },
  grid: {
    line: {
      style: {
        lineDash: [3, 3],
      },
    }, // è®¾ç½®åæ ‡ç³»æ …æ ¼æ ·å¼
  },
});
```

- `chart.tooltip()` é…ç½®é¡¹æ›´æ–°ï¼ŒåŒæ—¶å°† G2 3.x ç‰ˆæœ¬ä¸­ä¸€äº›é’ˆå¯¹ç‰¹å®šå›¾è¡¨çš„å†…ç½®è§„åˆ™åˆ é™¤ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±é€šè¿‡æä¾›çš„é…ç½®é¡¹è¿›è¡Œé…ç½®ï¼Œå…·ä½“é…ç½®å±æ€§è¯¦è§ [API](../api/classes/view#tooltip)ã€‚

  - tooltip çš„èƒŒæ™¯è¾…åŠ©æ¡†ä¸å†é…ç½®é¡¹ä¸­æ”¯æŒï¼Œéœ€è¦ä½¿ç”¨ `chart.interaction('active-region');` åŒæ—¶æ”¯æŒç›´è§’åæ ‡ç³»å’Œæåæ ‡ç³»ã€‚

  <img src="https://gw.alipayobjects.com/mdn/rms_f5c722/afts/img/A*j05pRJG3ovgAAAAAAAAAAABkARQnAQ" width=600 />

- `chart.legend()`Â  é…ç½®é¡¹æ›´æ–°ï¼Œå…·ä½“çš„é…ç½®è§ [API](../api/classes/view#legend)ã€‚ä»¥ä¸‹åˆ—ä¸¾äº†ä¸€äº› 3.x å¸¸ç”¨çš„å±æ€§ä»¥åŠ 4.0 çš„æ›¿ä»£æ–¹æ¡ˆï¼š

  - ğŸ—‘ï¸ `clickable` å±æ€§ç§»é™¤ï¼Œå¦‚æƒ³è¦å–æ¶ˆ legend å‹¾é€‰äº¤äº’ï¼Œå¯ä»¥é€šè¿‡ `chart.removeInteraction('legend-filter')` ç§»é™¤åˆ†ç±»å›¾ä¾‹çš„å‹¾é€‰äº¤äº’ã€‚
  - ğŸ—‘ï¸ `selectedMode` å±æ€§ç§»é™¤ï¼Œ4.0 å¯é€šè¿‡è‡ªå®šä¹‰äº¤äº’è¡Œä¸ºå®ç°ã€‚
  - ğŸ—‘ï¸ `onClick` å±æ€§ç§»é™¤ï¼Œ4.0 å¯é€šè¿‡ç›‘å¬ legend äº‹ä»¶å®ç°ï¼š`chart.on('legend:click', (ev) => {})`ã€‚
  - ğŸ—‘ï¸ `slidable` å±æ€§ç§»é™¤ï¼Œ4.0 å¯ä»¥é€šè¿‡ `chart.removeInteraction('continuous-filter')` ç§»é™¤è¿ç»­å›¾ä¾‹çš„æ»‘å—äº¤äº’ã€‚
  - ğŸ—‘ï¸ `hoverable` å±æ€§ç§»é™¤ï¼Œ4.0 å¯ä»¥é€šè¿‡ `chart.interaction('legend-active')` ç­‰äº¤äº’è¡Œä¸ºå®ç°ï¼Œå‚è€ƒäº¤äº’è¯­æ³• demo: https://g2.antv.vision/en/examples/interaction/component#legend-activeã€‚
  - ğŸ—‘ï¸ `onHover` å±æ€§ç§»é™¤ï¼Œ4.0 å¯ä»¥é€šè¿‡ç›‘å¬ legend äº‹ä»¶å®ç°ï¼š`chart.on('legend:mousemove', (ev) => {})`ã€‚

- `chart.axis()`Â  é…ç½®é¡¹æ›´æ–°ï¼Œè¯¦è§ [API](../api/classes/view#axis)ã€‚
- `chart.annotation()`Â  å„ä¸ªç±»å‹çš„ annotation é…ç½®é¡¹æ›´æ–°ï¼Œè¯¦è§ [API](../api/classes/view#annotation)ã€‚
- `geometry().style()` æ–¹æ³•çš„å›è°ƒå‡½æ•°å†™æ³•å˜æ›´ï¼Œä¸å†æ”¯æŒä¸€ä¸ªé…ç½®å±æ€§ä¸€ä¸ªå›è°ƒçš„æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå›è°ƒï¼š

```typescript
style('a', (aVal) => {
  if (a === 1) return { fill: 'red' };
  return { fill: 'blue' };
});
```

è¯¦è§ [API](../api/classes/geometry#style)ã€‚

- `geometry.label()` æ¥å£æ›´æ–°ï¼Œä¸å†æ”¯æŒ html ç±»å‹çš„ labelï¼Œè¯¦è§ [API](../api/classes/geometry#label)ã€‚

---

ğŸ’Œ å¦‚æœæ‚¨åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœ¬å‡çº§æŒ‡å—é—æ¼ä¹‹å¤„ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ï¼ˆ[è”ç³»æ–¹å¼](./contact)ï¼‰ï¼Œéå¸¸æ„Ÿè°¢ï¼
