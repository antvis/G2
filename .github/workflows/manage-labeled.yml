name: Manage Labeled Issue

on:
  issues:
    types: [labeled]

permissions: {}

jobs:
  manage-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      # å½“æ·»åŠ åˆ†ç±»æ ‡ç­¾æ—¶ï¼Œç§»é™¤ 'waiting for maintainer' æ ‡ç­¾
      - name: Remove `waiting for maintainer` label when other triage labels are added
        uses: actions/github-script@v7.0.1
        with:
          script: |
            const labelsToCheck = ['waiting for author', 'need improvement', 'bug ğŸ›', 'documentation ğŸ“–', 'feature ğŸ’¡', 'question ğŸ’¬', 'notabug', 'stale', 'wontfix', 'duplicate'];

            const labelToRemove = 'waiting for maintainer';
            const newLabel = context.payload.label.name;

            if (labelsToCheck.includes(newLabel)) {
                const { data: labels } = await github.rest.issues.listLabelsOnIssue({
                  issue_number: context.issue.number,
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                });
                if (labels.some(label => label.name === labelToRemove)) {
                  await github.rest.issues.removeLabel({
                    issue_number: context.issue.number,
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: labelToRemove,
                  });
                }
            }

      # å½“æ·»åŠ  'need improvement' æ ‡ç­¾æ—¶ï¼ŒåŒæ—¶æ·»åŠ  'waiting for author' æ ‡ç­¾
      - name: Append label if `need improvement` is added
        if: github.event.label.name == 'need improvement'
        uses: actions-cool/issues-helper@v3.6.0
        with:
          actions: "add-labels"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          labels: "waiting for author"

      # å½“æ·»åŠ  'need improvement' æ ‡ç­¾æ—¶ï¼Œå‘é€æé†’è¯„è®º
      - name: Warn bad issue when `need improvement` label is added
        if: github.event.label.name == 'need improvement'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "create-comment"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ“ To help us better understand and address your issue, **please provide more information, or use the standard format**, otherwise we will not process this issue.

            Reference document: 

              - [Creating an issue](https://docs.github.com/en/issues/tracking-your-work-with-issues/using-issues/creating-an-issue)
              - [Basic writing and formatting syntax](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax)

            ---

            ğŸ“ ä¸ºäº†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œè§£å†³ä½ çš„é—®é¢˜ï¼Œ**è¯·æä¾›æ›´å¤šä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨è§„èŒƒçš„æ ¼å¼**ï¼Œå¦åˆ™æˆ‘ä»¬ä¸ä¼šå¤„ç†è¿™ä¸ª issueã€‚

            å‚è€ƒæ–‡æ¡£ï¼š

              - [åˆ›å»ºè®®é¢˜](https://docs.github.com/zh/issues/tracking-your-work-with-issues/using-issues/creating-an-issue)
              - [åŸºæœ¬æ’°å†™å’Œæ ¼å¼è¯­æ³•](https://docs.github.com/zh/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax)
          emoji: "heart"

      # å¤„ç† stale æ ‡ç­¾
      - name: Add stale issue comment before closing
        if: github.event.label.name == 'stale'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "create-comment"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            âš ï¸ This issue has been automatically closed due to inactivity. 

            - If the issue is still relevant and important to you, feel free to:
              1. Reopen with additional information
              2. Create a new issue with updated context
              3. Reference any related issues or discussions

            We close inactive issues to keep our backlog manageable and focused on active issues.

            Your contribution makes our project better! ğŸŒŸ

            ---

            âš ï¸ ç”±äºé•¿æœŸæ— æ´»åŠ¨ï¼Œæ­¤ issue å·²è¢«è‡ªåŠ¨å…³é—­ã€‚

            - å¦‚æœè¿™ä¸ªé—®é¢˜å¯¹æ‚¨æ¥è¯´ä»ç„¶é‡è¦ï¼Œæ‚¨å¯ä»¥ï¼š
              1. é‡æ–°æ‰“å¼€å¹¶æä¾›è¡¥å……ä¿¡æ¯
              2. åˆ›å»ºä¸€ä¸ªæ–°çš„ issue å¹¶æ›´æ–°ç›¸å…³èƒŒæ™¯
              3. å…³è”ç›¸å…³çš„ issue æˆ–è®¨è®º

            ä¸ºäº†æ›´å¥½åœ°ç»´æŠ¤é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦å®šæœŸæ¸…ç†ä¸æ´»è·ƒçš„é—®é¢˜ã€‚

            æ„Ÿè°¢æ‚¨ä¸ºå¼€æºæ·»ç –åŠ ç“¦ï¼ğŸŒŸ
          emoji: "heart"

      - name: Close stale issue
        if: github.event.label.name == 'stale'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "close-issue"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}

      # å¤„ç† wontfix æ ‡ç­¾
      - name: Add wontfix issue comment before closing
        if: github.event.label.name == 'wontfix'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "create-comment"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸš« This issue has been marked as "Won't Fix". Here's why:

            - The described behavior is working as intended
            - The request falls outside our project scope/goals
            - The cost/benefit ratio doesn't justify the change

            If you have new information that might change this decision, feel free to:
            1. Share your additional context
            2. Propose alternative solutions
            3. Start a discussion to explore different approaches

            Thank you for your understanding and engagement! ğŸ™

            ---

            ğŸš« æ­¤ issue è¢«æ ‡è®°ä¸º"ä¸äºˆä¿®å¤"ï¼ŒåŸå› å¦‚ä¸‹ï¼š

            - å½“å‰è¡Œä¸ºç¬¦åˆè®¾è®¡é¢„æœŸ
            - è¯¥è¯·æ±‚è¶…å‡ºé¡¹ç›®èŒƒå›´/ç›®æ ‡
            - æŠ•å…¥äº§å‡ºæ¯”ä¸è¶³ä»¥æ”¯æŒæ­¤å˜æ›´

            å¦‚æœæ‚¨æœ‰ä»»ä½•æ–°çš„æƒ³æ³•æˆ–å»ºè®®ï¼Œæ¬¢è¿ï¼š
            1. åˆ†äº«æ›´å¤šä¸Šä¸‹æ–‡
            2. æå‡ºæ›¿ä»£æ–¹æ¡ˆ
            3. å‘èµ·è®¨è®ºä»¥æ¢ç´¢ä¸åŒæ€è·¯

            æ„Ÿè°¢ç†è§£ä¸æ”¯æŒï¼ğŸ™
          emoji: "heart"

      - name: Close wontfix issue
        if: github.event.label.name == 'wontfix'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "close-issue"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}

      # å¤„ç† notabug æ ‡ç­¾
      - name: Add notabug issue comment before closing
        if: github.event.label.name == 'notabug'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "create-comment"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            âœ… After careful review, we've determined this is not a bug. Here's why:

            - The current behavior is working as designed
            - This might be a misunderstanding of the feature
            - The issue cannot be reproduced with the provided information

            If you still believe this is a bug, please:
            1. Provide a minimal reproduction
            2. Share your expected behavior
            3. Include more detailed environment information

            Thank you for helping us improve our project! ğŸ’«

            ---

            âœ… ç»è¿‡ä»”ç»†æ ¸æŸ¥ï¼Œè¿™å¹¶éä¸€ä¸ª bugï¼ŒåŸå› å¦‚ä¸‹ï¼š

            - å½“å‰è¡¨ç°ç¬¦åˆè®¾è®¡é¢„æœŸ
            - å¯èƒ½æ˜¯å¯¹åŠŸèƒ½ç†è§£æœ‰æ‰€åå·®
            - åŸºäºå·²æä¾›ä¿¡æ¯æ— æ³•å¤ç°é—®é¢˜

            å¦‚æœæ‚¨ä»è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ª bugï¼Œå»ºè®®ï¼š
            1. æä¾›æœ€å°å¤ç°ç¤ºä¾‹
            2. è¯´æ˜æ‚¨æœŸæœ›çš„è¡¨ç°
            3. è¡¥å……æ›´è¯¦ç»†çš„ç¯å¢ƒä¿¡æ¯

            æœŸå¾…æ‚¨çš„åé¦ˆï¼ğŸ’«
          emoji: "heart"

      - name: Close notabug issue
        if: github.event.label.name == 'notabug'
        uses: actions-cool/issues-helper@v3
        with:
          actions: "close-issue"
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
